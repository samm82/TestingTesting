% Based on https://www.overleaf.com/learn/latex/LaTeX_Graphics_using_TikZ%3A_A_Tutorial_for_Beginners_(Part_3)%E2%80%94Creating_Flowcharts

\tikzstyle{startend} = [rectangle, rounded corners,
minimum width=3cm,
minimum height=1cm,
text centered,
text width=3cm,
draw=black,
fill=red!30]

\tikzstyle{io} = [trapezium,
trapezium stretches=true, % A later addition
trapezium left angle=70,
trapezium right angle=110,
minimum width=3cm,
minimum height=1cm,
text centered,
text width=3cm,
draw=black, fill=blue!30]

\tikzstyle{process} = [rectangle,
minimum width=3cm,
minimum height=1cm,
text centered,
text width=4cm,
draw=black,
fill=orange!30]

% Hacky but I can't think of a better way to do this
\tikzstyle{decisionL} = [diamond,
aspect=1.75,
minimum width=0.25cm,
minimum height=0.25cm,
text centered,
text width=3cm,
draw=black,
fill=green!30]

\tikzstyle{decisionS} = [diamond,
aspect=1.75,
minimum width=0.25cm,
minimum height=0.25cm,
text centered,
text width=2cm,
draw=black,
fill=green!30]

\tikzstyle{arrow} = [thick,->,>=stealth]

\begin{figure}
    \begin{tikzpicture}[node distance=2cm]

        \node (start)   [startend] {Start};
        \node (ident)   [io, right of=start, xshift=3.5cm] {New Test Approach Identified};
        \node (present) [decisionS, right of=ident, xshift=3cm] {Present in Glossary?};

        \node (newrow) [process, below of=present, yshift=-0.5cm] {Create New Row in Glossary};
        \node (newapp) [process, below of=newrow] {Record Approach Name and Category as ``Approach''};

        \node (catapp)   [decisionL, below of=start,  yshift=-0.5cm] {Given Category is ``Approach''?};
        \node (catgiven) [decisionS, below of=ident,  yshift=-0.5cm] {Category Given?};
        \node (catmatch) [decisionL, below of=catapp, yshift=-2.5cm] {Given Category Matches Present Category?};

        \node (replace) [process, below of=catgiven, yshift=-1.25cm, xshift=-0.5cm] {Replace ``Approach'' with Given Category};
        \node (matches) [process, below of=catmatch, yshift=-1cm] {Add Citation};
        \node (nomatch) [process, below of=replace,  yshift=-1cm] {Add Given Category};

        \node (out1) [io, below of=newapp, yshift=-3.5cm] {Output};
        \node (end) [startend, below of=out1] {End};

        \draw [arrow] (start) -- (ident);
        \draw [arrow] (ident) -- (present);
        \draw [arrow] (present) -- node[anchor=south] {yes} (catgiven);
        \draw [arrow] (present) -- node[anchor=east]  {no}  (newrow);
        \draw [arrow] (newrow) -- (newapp);
        \draw [arrow] (newapp.west) -- (catgiven);

        \draw [arrow] (catgiven) -- node[anchor=south] {yes} (catapp);
        \draw [arrow] (catapp)   -- node[anchor=south] {yes} (replace);
        \draw [arrow] (catapp)   -- node[anchor=east]  {no}  (catmatch);
        \draw [arrow] (catmatch) -- node[anchor=east]  {yes} (matches);
        \draw [arrow] (catmatch) -- node[anchor=south] {no}  (nomatch);

        \draw [arrow] (catgiven) -- node[anchor=west] {no} (out1);
        \draw [arrow] (matches) -- (out1);
        \draw [arrow] (nomatch) -- (out1);
        \draw [arrow] (replace) -- (out1);
        \draw [arrow] (out1) -- (end);

    \end{tikzpicture}
    \caption{Procedure for recording test approaches in our glossary.}
    \label{fig:recAppFlowchart}
\end{figure}